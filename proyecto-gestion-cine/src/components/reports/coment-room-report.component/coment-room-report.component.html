<div class="coment-room-report-container">
  <div class="report-header">
    <h1 class="report-title">
      <i class="bi bi-chat-dots"></i>
      Reporte de Comentarios de Salas
    </h1>
    <p class="report-subtitle">Filtrado por intervalo de tiempo y sala</p>
  </div>

  <div class="filters-card">
    <form [formGroup]="reportForm" (ngSubmit)="generateReport()">
      <div class="row g-3 align-items-end">
        <div class="col-md-5">
          <label for="fechaInicio" class="form-label">Fecha Inicio</label>
          <input type="date" id="fechaInicio" class="form-control" formControlName="fechaInicio" />
        </div>

        <div class="col-md-5">
          <label for="fechaFin" class="form-label">Fecha Fin</label>
          <input type="date" id="fechaFin" class="form-control" formControlName="fechaFin" />
        </div>

        <div class="col-md-5">
          <label for="sala" class="form-label">Sala</label>
          <input
            type="text"
            id="sala"
            class="form-control"
            formControlName="nombreSala"
            placeholder="Ingrese el nombre de la sala"
          />
        </div>

        <div class="col-md-2">
          <button
            type="submit"
            class="btn-generate w-100"
            [disabled]="isLoading || reportForm.invalid"
          >
            @if (isLoading) {
            <span>Generando...</span>
            } @if (!isLoading) {
            <span><i class="bi bi-search"></i> Generar</span>
            }
          </button>
        </div>
      </div>
    </form>

    @if (comentarios.length > 0) {
    <div class="comments-section mt-4">
      <h2>Comentarios</h2>

      @for (comentario of comentarios; track comentario.idSala) {
      <div class="comment-item mb-2 p-2 border rounded">
        <p>
          <strong>{{ comentario.nombreUsuario }}:</strong>
          {{ comentario.comentario }}
        </p>
        <p class="text-muted">
          <small
            >Fecha de Publicaci칩n: {{ comentario.fechaPublicacion | date : 'dd/MM/yyyy' }}</small
          >
        </p>
      </div>
      }

      <div class="text-center mt-3">
        @if (tieneMasComentarios && !isLoadingMore) {
        <button class="btn btn-secondary" (click)="loadMore()">Ver M치s</button>
        } @if (isLoadingMore) {
        <p>Cargando m치s comentarios...</p>
        } @if (!tieneMasComentarios) {
        <p>No hay m치s comentarios para mostrar.</p>
        }
      </div>
    </div>
    }
  </div>
</div>

<app-share-popup
  [mensaje]="infoMessage || ''"
  [tipo]="popupTipo"
  [mostrar]="popupMostrar"
  (cerrarEvent)="infoMessage = null"
></app-share-popup>
