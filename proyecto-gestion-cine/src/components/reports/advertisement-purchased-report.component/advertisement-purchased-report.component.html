<div class="purchase-advertisement-report-container">
  <div class="report-header">
    <h1 class="report-title">
      <i class="bi bi-megaphone-fill"></i>
      Reporte de Anuncios Comprados
    </h1>
    <p class="report-subtitle">Filtra por intervalo de tiempo y tipo de anuncio</p>
  </div>

  <div class="filters-card">
    <form [formGroup]="reportForm" (ngSubmit)="generateReport()">
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label for="fechaInicio" class="form-label">Fecha Inicio</label>
          <input type="date" id="fechaInicio" class="form-control" formControlName="fechaInicio" />
        </div>
        <div class="col-md-4">
          <label for="fechaFin" class="form-label">Fecha Fin</label>
          <input type="date" id="fechaFin" class="form-control" formControlName="fechaFin" />
        </div>
        <div class="col-md-4">
          <label for="tipoAnuncio" class="form-label">Tipo de Anuncio</label>
          <select id="tipoAnuncio" class="form-control" formControlName="tipoAnuncio">
            <option value="" disabled>Seleccione un filtro</option>
            @for( tipo of tiposAnuncios; track tipo.length){
            <option [value]="tipo">{{ tipo }}</option>
            }
          </select>
        </div>
        <div class="col-md-2">
          <button
            type="submit"
            class="btn-generate w-100"
            [disabled]="isLoading || reportForm.invalid"
          >
            @if(isLoading){
            <span>Generando...</span>
            } @if(!isLoading){

            <span><i class="bi bi-search"></i> Generar</span>
            }
          </button>
        </div>
      </div>
    </form>

    @if(errorMessage){
    <div class="alert-error mt-3">
      <i class="bi bi-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>
    }
  </div>

  @if(report){
  <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID Anuncio</th>
          <th>ID Usuario</th>
          <th>Nombre Anuncio</th>
          <th>Fecha Compra</th>
          <th>Monto Pago</th>
          <th>Tipo Anuncio</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ad of report.purchasedAdvertisements">
          <td>{{ ad.idAnuncio }}</td>
          <td>{{ ad.idUsuario }}</td>
          <td>{{ ad.nombreAnuncio }}</td>
          <td>{{ ad.fechaCompra | date : 'dd/MM/yyyy' }}</td>
          <td>Q {{ ad.montoPago | number : '1.2-2' }}</td>
          <td>{{ ad.tipoAnuncio }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  }
</div>
