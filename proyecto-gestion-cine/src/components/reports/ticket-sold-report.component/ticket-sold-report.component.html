<div class="ticket-sold-report">
  <header class="report-header">
    <h1>
      <i class="bi bi-ticket-perforated"></i>
      Reporte de Boletos Vendidos
    </h1>
    <p>
      Reporte de boletos vendidos en un intervalo de tiempo. Incluye el listado de usuarios que
      compraron boletos para cada sala y el total de dinero recaudado.
    </p>
  </header>

  <section class="filters">
    <form [formGroup]="reportForm" (ngSubmit)="generateReport()">
      <div class="form-grid">
        <div class="form-field">
          <label for="fechaInicio">Fecha Inicio</label>
          <input type="date" id="fechaInicio" formControlName="fechaInicio" />
        </div>
        <div class="form-field">
          <label for="fechaFin">Fecha Fin</label>
          <input type="date" id="fechaFin" formControlName="fechaFin" />
        </div>
        <div class="form-field">
          <label for="nombreSala">Sala (opcional)</label>
          <input
            type="text"
            id="nombreSala"
            placeholder="Ingrese el nombre de la sala"
            formControlName="nombreSala"
          />
        </div>
        <div class="form-action">
          <button type="submit" [disabled]="isLoading" class="btn-generate">
            @if (isLoading) {
            <span>Generando...</span>
            } @else {
            <i class="bi bi-graph-up"></i>
            <span>Generar</span>
            }
          </button>
        </div>
      </div>
    </form>
  </section>

  @if (report) {
  <section class="summary">
    <h2><i class="bi bi-cash-stack"></i> Resumen General</h2>

    @if (report.boletosVendidos.length === 0) {
    <div class="alert">
      <i class="bi bi-info-circle"></i>
      No hay boletos vendidos para los filtros seleccionados.
    </div>
    } @else {
    <div class="summary-grid">
      <div class="summary-card">
        <i class="bi bi-currency-dollar"></i>
        <div>
          <h3>Total Recaudado</h3>
          <p>{{ report.totalDinero | currency }}</p>
        </div>
      </div>
      <div class="summary-card">
        <i class="bi bi-easel"></i>
        <div>
          <h3>Salas con Ventas</h3>
          <p>{{ report.boletosVendidos.length }}</p>
        </div>
      </div>
    </div>
    }
  </section>

  @if (report.boletosVendidos.length > 0) {
  <section class="details">
    <h2><i class="bi bi-list-ul"></i> Detalles por Sala</h2>

    @for (venta of report.boletosVendidos; track venta.idSala) {
    <article class="room-block">
      <header class="room-header">
        <h3><i class="bi bi-easel"></i> {{ venta.nombreSala }}</h3>
        <span class="room-id">ID: {{ venta.idSala }}</span>
        <span class="stat"><i class="bi bi-people"></i> {{ venta.usuarios.length }} clientes</span>
      </header>

      <div class="table-wrapper">
        <table class="sales-table">
          <thead>
            <tr>
              <th>ID Usuario</th>
              <th>Nombre</th>
              <th>Boletos</th>
              <th>Monto Pagado</th>
              <th>Fecha de Pago</th>
            </tr>
          </thead>
          <tbody>
            @for (usuario of venta.usuarios; track usuario.idUsuario) {
            <tr>
              <td>{{ usuario.idUsuario }}</td>
              <td class="fw-bold">{{ usuario.nombreUsuario }}</td>
              <td><i class="bi bi-ticket"></i> {{ usuario.cantidadBoleto }}</td>
              <td>{{ usuario.montoPago | currency }}</td>
              <td>{{ usuario.fechaPago | date : 'dd/MM/yyyy HH:mm' }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </article>
    }
  </section>
  } }
</div>

<app-share-popup
  [mensaje]="infoMessage || ''"
  [tipo]="popupTipo"
  [mostrar]="popupMostrar"
  (cerrarEvent)="infoMessage = null"
></app-share-popup>
